<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.modules.service.dao.technician.TechScheduleDao">
    
	<sql id="techScheduleColumns">
		a.id AS "id",
		a.tech_id AS "techId",
		a.schedule_date AS "scheduleDate",
		a.schedule_week AS "scheduleWeek",
		a.start_time AS "startTime",
		a.end_time AS "endTime",
		a.type_id AS "typeId",
		a.type AS "type",
		a.remark AS "remark",
		a.create_by AS "createBy.id",
		a.create_date AS "createDate",
		a.update_by AS "updateBy.id",
		a.update_date AS "updateDate",
		a.del_flag AS "delFlag"
	</sql>

	<!--根据typeId查询排期表-->
	<select id="getSchedule" resultType="TechScheduleInfo">
		SELECT
		<include refid="techScheduleColumns"/>
		FROM tech_schedule a
		WHERE a.type_id = #{typeId}
		AND a.del_flag=#{delFlag}
	</select>

	<!--根据技师id 开始时间 结束时间 获取排期表集合-->
	<select id="getScheduleByTechId" resultType="TechScheduleInfo">
		SELECT
		<include refid="techScheduleColumns"/>
		FROM tech_schedule a
		WHERE a.tech_id = #{techId}
		AND ((a.start_time &lt;= #{startTime} AND a.end_time &gt; #{startTime}) OR (a.start_time &gt;= #{startTime} AND a.start_time &lt; #{endTime}))
		AND a.del_flag=#{delFlag}
	</select>

	<!--删除排期表-->
	<update id="deleteSchedule">
		UPDATE tech_schedule SET
		del_flag = '1'
		WHERE id = #{id}
	</update>

	<!--增加排期表-->
	<insert id="insertSchedule">
		INSERT INTO tech_schedule(
		id,
		tech_id,
		start_time,
		end_time,
		schedule_date,
		schedule_week,
		type_id,
		type,
		remark,
		create_by,
		create_date,
		update_by,
		update_date,
		del_flag
		) VALUES (
		#{id},
		#{techId},
		#{startTime},
		#{endTime},
		#{scheduleDate},
		#{scheduleWeek},
		#{typeId},
		#{type},
		#{remark},
		#{createBy.id},
		#{createDate},
		#{updateBy.id},
		#{updateDate},
		#{delFlag}
		)
	</insert>

</mapper>